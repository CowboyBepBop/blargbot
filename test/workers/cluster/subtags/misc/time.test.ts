import { TooManyArgumentsError } from '@cluster/bbtag/errors';
import { TimeSubtag } from '@cluster/subtags/misc/time';
import moment from 'moment-timezone';

import { MarkerError, runSubtagTests } from '../SubtagTestSuite';

runSubtagTests({
    subtag: new TimeSubtag(),
    cases: [
        { code: '{time}', expected: () => moment.tz('Etc/UTC').format('YYYY-MM-DDTHH:mm:ssZ'), retries: 5 },
        { code: '{time;}', expected: () => moment.tz('Etc/UTC').format('YYYY-MM-DDTHH:mm:ssZ'), retries: 5 },
        { code: '{time;;}', expected: () => moment.tz('Etc/UTC').format('YYYY-MM-DDTHH:mm:ssZ'), retries: 5 },
        { code: '{time;;;}', expected: () => moment.tz('Etc/UTC').format('YYYY-MM-DDTHH:mm:ssZ'), retries: 5 },
        { code: '{time;;;;}', expected: () => moment.tz('Etc/UTC').format('YYYY-MM-DDTHH:mm:ssZ'), retries: 5 },
        { code: '{time;;;;;}', expected: () => moment.tz('Etc/UTC').format('YYYY-MM-DDTHH:mm:ssZ'), retries: 5 },

        { code: '{time;X}', expected: () => moment.tz('Etc/UTC').format('X'), retries: 5 },
        { code: '{time;X;}', expected: () => moment.tz('Etc/UTC').format('X'), retries: 5 },
        { code: '{time;X;;}', expected: () => moment.tz('Etc/UTC').format('X'), retries: 5 },
        { code: '{time;X;;;}', expected: () => moment.tz('Etc/UTC').format('X'), retries: 5 },
        { code: '{time;X;;;;}', expected: () => moment.tz('Etc/UTC').format('X'), retries: 5 },
        { code: '{time;DD/MM/YYYY}', expected: () => moment.tz('Etc/UTC').format('DD/MM/YYYY'), retries: 5 },
        { code: '{time;DD/MM/YYYY;}', expected: () => moment.tz('Etc/UTC').format('DD/MM/YYYY'), retries: 5 },
        { code: '{time;DD/MM/YYYY;;}', expected: () => moment.tz('Etc/UTC').format('DD/MM/YYYY'), retries: 5 },
        { code: '{time;DD/MM/YYYY;;;}', expected: () => moment.tz('Etc/UTC').format('DD/MM/YYYY'), retries: 5 },
        { code: '{time;DD/MM/YYYY;;;;}', expected: () => moment.tz('Etc/UTC').format('DD/MM/YYYY'), retries: 5 },

        { code: '{time;;1640995200}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;1640995200;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;1640995200;;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;1640995200;;;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;X;1640995200}', expected: '1640995200' },
        { code: '{time;X;1640995200;}', expected: '1640995200' },
        { code: '{time;X;1640995200;;}', expected: '1640995200' },
        { code: '{time;X;1640995200;;;}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY;1640995200}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;1640995200;}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;1640995200;;}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;1640995200;;;}', expected: '01/01/2022' },

        { code: '{time;;1640995200;X}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;1640995200;X;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;1640995200;X;;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;X;1640995200;X}', expected: '1640995200' },
        { code: '{time;X;1640995200;X;}', expected: '1640995200' },
        { code: '{time;X;1640995200;X;;}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY;1640995200;X}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;1640995200;X;}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;1640995200;X;;}', expected: '01/01/2022' },
        { code: '{time;;01/01/2022;DD/MM/YYYY}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY}', expected: '1640995200' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;}', expected: '1640995200' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;;}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY;01/01/2022;DD/MM/YYYY}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;01/01/2022;DD/MM/YYYY;}', expected: '01/01/2022' },
        { code: '{time;DD/MM/YYYY;01/01/2022;DD/MM/YYYY;;}', expected: '01/01/2022' },

        { code: '{time;;01/01/2022;DD/MM/YYYY;Etc/UTC}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Etc/UTC;}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Etc/UTC}', expected: '1640995200' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Etc/UTC;}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Etc/UTC}', expected: '01/01/2022 00:00' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Etc/UTC;}', expected: '01/01/2022 00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Europe/Berlin}', expected: '2021-12-31T23:00:00+00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Europe/Berlin;}', expected: '2021-12-31T23:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Europe/Berlin}', expected: '1640991600' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Europe/Berlin;}', expected: '1640991600' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Europe/Berlin}', expected: '31/12/2021 23:00' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Europe/Berlin;}', expected: '31/12/2021 23:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;America/New_York}', expected: '2022-01-01T05:00:00+00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;America/New_York;}', expected: '2022-01-01T05:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;America/New_York}', expected: '1641013200' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;America/New_York;}', expected: '1641013200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;America/New_York}', expected: '01/01/2022 05:00' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;America/New_York;}', expected: '01/01/2022 05:00' },

        { code: '{time;;01/01/2022;DD/MM/YYYY;Etc/UTC;Etc/UTC}', expected: '2022-01-01T00:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Etc/UTC;Etc/UTC}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Etc/UTC;Etc/UTC}', expected: '01/01/2022 00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Europe/Berlin;Etc/UTC}', expected: '2021-12-31T23:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Europe/Berlin;Etc/UTC}', expected: '1640991600' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Europe/Berlin;Etc/UTC}', expected: '31/12/2021 23:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;America/New_York;Etc/UTC}', expected: '2022-01-01T05:00:00+00:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;America/New_York;Etc/UTC}', expected: '1641013200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;America/New_York;Etc/UTC}', expected: '01/01/2022 05:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Etc/UTC;Europe/Berlin}', expected: '2022-01-01T01:00:00+01:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Etc/UTC;Europe/Berlin}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Etc/UTC;Europe/Berlin}', expected: '01/01/2022 01:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Europe/Berlin;Europe/Berlin}', expected: '2022-01-01T00:00:00+01:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Europe/Berlin;Europe/Berlin}', expected: '1640991600' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Europe/Berlin;Europe/Berlin}', expected: '01/01/2022 00:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;America/New_York;Europe/Berlin}', expected: '2022-01-01T06:00:00+01:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;America/New_York;Europe/Berlin}', expected: '1641013200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;America/New_York;Europe/Berlin}', expected: '01/01/2022 06:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Etc/UTC;America/New_York}', expected: '2021-12-31T19:00:00-05:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Etc/UTC;America/New_York}', expected: '1640995200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Etc/UTC;America/New_York}', expected: '31/12/2021 19:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;Europe/Berlin;America/New_York}', expected: '2021-12-31T18:00:00-05:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;Europe/Berlin;America/New_York}', expected: '1640991600' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;Europe/Berlin;America/New_York}', expected: '31/12/2021 18:00' },
        { code: '{time;;01/01/2022;DD/MM/YYYY;America/New_York;America/New_York}', expected: '2022-01-01T00:00:00-05:00' },
        { code: '{time;X;01/01/2022;DD/MM/YYYY;America/New_York;America/New_York}', expected: '1641013200' },
        { code: '{time;DD/MM/YYYY HH:mm;01/01/2022;DD/MM/YYYY;America/New_York;America/New_York}', expected: '01/01/2022 00:00' },

        {
            code: '{time;{eval};{eval};{eval};{eval};{eval};{eval}}',
            expected: '`Too many arguments`',
            errors: [
                { start: 6, end: 12, error: new MarkerError('eval', 6) },
                { start: 13, end: 19, error: new MarkerError('eval', 13) },
                { start: 20, end: 26, error: new MarkerError('eval', 20) },
                { start: 27, end: 33, error: new MarkerError('eval', 27) },
                { start: 34, end: 40, error: new MarkerError('eval', 34) },
                { start: 46, end: 52, error: new MarkerError('eval', 46) },
                { start: 0, end: 53, error: new TooManyArgumentsError(5, 6) }
            ]
        }

    ]
});
